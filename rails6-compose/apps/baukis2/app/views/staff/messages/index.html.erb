<%# ¥ 2.ch.11.1.3 ツリー構造 %>
<%#  - messages_controller.rbより、下記のように render action: "index" としているため、index.html.erbを共有している

  def index
    # * message.rb の scopeを使用している
    @messages = Message.not_deleted.sorted.page(params[:page])
  end

  # GET
  def inbound
    @messages = CustomerMessage.not_deleted.sorted.page(params[:page])
    render action: "index"
  end

  # GET
  def outbound
    @messages = StaffMessage.not_deleted.sorted.page(params[:page])
    render action: "index"
  end

  # GET
  def deleted
    @messages = Message.deleted.sorted.page(params[:page])
    render action: "index"
  end %>
  <%# ^ case params[:action] でaction毎に表示メッセージを変更している %>
<%
@title =
  case params[:action]
  when "index"; "全メッセージ一覧"
  when "inbound"; "問い合わせ一覧"
  when "outbound"; "返信一覧"
  when "deleted"; "メッセージ一覧（ゴミ箱）"
  else; raise
  end
%>
<h1><%= @title %></h1>

<div class="table-wrapper">
  <%# ¥ 2.ch.12.3.4 タグ付け %>
  <%= render "links" %>

  <%= paginate @messages %>

  <table class="listing">
    <tr>
      <th>種類</th>
      <th>送信者</th>
      <th>受信者</th>
      <th>件名</th>
      <th>作成日時</th>
      <th>アクション</th>
    </tr>
    <% @messages.each do |m| %>
      <% p = MessagePresenter.new(m, self) %>
      <tr>
        <td><%= p.type %></td>
        <td><%= p.sender %></td>
        <td><%= p.receiver %></td>
        <td><%= p.truncated_subject %></td>
        <td><%= p.created_at %></td>
        <td class="actions">
          <%= link_to "詳細", staff_message_path(m) %> |
          <%= link_to_if m.kind_of?(CustomerMessage), "削除",
            staff_message_path(m), method: :delete %>
        </td>
      </tr>
    <% end %>
  </table>

  <%= paginate @messages %>

  <%# ¥ 2.ch.12.3.3 タグ付け %>
  <%= render "tags" %>
</div>